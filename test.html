<!DOCTYPE html>
<meta charset="utf-8">
<svg id="svgContainer" width="500" height="300">
    <g class="zoomable-group">
        <rect class="zoomable-rect" width="200" height="100" x="150" y="100" fill="none" stroke="black" />
        <rect class="centered-rect" width="50" height="50" x="225" y="125" stroke="red" fill="none" />
        <rect class="centered-rect2" width="50" height="50" x="225" y="125" stroke="blue" fill="none"/>
    </g>
  </svg>
<script type="module">
import {zoom} from "https://cdn.skypack.dev/d3-zoom@3";
const handler = zoom();
</script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
const svgContainer = d3.select("#svgContainer");
const zoomableRect = svgContainer.select(".zoomable-rect")
const centerRect = svgContainer.select(".centered-rect")
const centerRect2 = svgContainer.select(".centered-rect2")

const myzoom = d3.zoom()
  .scaleExtent([0.5, 5])
  .on("zoom", zoomed);

svgContainer.call(myzoom);

function zoomed() {
    const event = d3.event
    zoomableRect.attr("transform", event.transform);
    const scaledWidth = +centerRect.attr("width") * event.transform.k 
    const scaledheight = +centerRect.attr("height") * event.transform.k
    // const scaledX = (+centerRect2.attr("x") + event.transform.x) * event.transform.k
    // const scaledY = (+centerRect2.attr("y") + event.transform.y) * event.transform.k 
    const scaledX = (+centerRect2.attr("x")) * event.transform.k + event.transform.x + +centerRect.attr("width")/2 * (event.transform.k-1)  - +centerRect.attr("x")
    const scaledY = (+centerRect2.attr("y")) * event.transform.k + event.transform.y + +centerRect.attr("height")/2 * (event.transform.k-1) - +centerRect.attr("y")
    // const scaledX = event.transform.x*event.transform.k
    // const scaledY = event.transform.y*event.transform.k
    // const recenterOffsetX = scaledX + scaledWidth/2
    // const recenterOffsetY = scaledY + scaledheight/2
    const recenterOffsetX = scaledX
    const recenterOffsetY = scaledY 
    console.log(recenterOffsetX, recenterOffsetY, event.transform)
    // centerRect.attr("transform", `scale(${event.transform.k})`)
    // centerRect.attr("transform",`translate(${event.transform.x},${event.transform.y}) scale(${event.transform.k}) translate(${-recenterOffsetX},${-recenterOffsetY}) scale(${1/event.transform.k}) translate(${recenterOffsetX},${recenterOffsetY})`)
    // centerRect.attr("transform",`translate(${event.transform.x},${event.transform.y}) scale(${event.transform.k}) translate(${-recenterOffsetX},${-recenterOffsetY})`)
    // centerRect.attr("transform",`translate(${event.transform.x},${event.transform.y})`)
    centerRect.attr("transform",`translate(${scaledX},${scaledY})`)
    centerRect2.attr("transform", `translate(${event.transform.x}, ${event.transform.y}) scale(${event.transform.k})`)
    // centerRect.attr("x", scaledX)
    //     .attr("y", scaledY)
}

</script>
<line class="sub-cluster-label-border-connector" x1="944.4266346983436" y1="256.93191991230526" x2="811.9161403354856" y2="32.80232957497191" stroke-width="3" stroke="rgb(51, 153, 112)" opacity="1"></line><rect class="sub-cluster-label-border" x="885.5951538085938" y="264.572096824646" width="167.9964599609375" height="69.86334609985352" pointer-events="none" fill="white" stroke-width="2" stroke="rgb(51, 153, 112)" opacity="1" transform="translate(-157.67722082276453, -251.73559149812462)"></rect><text class="sub-cluster-label" x="969.5933736474408" y="284.5379210730965" font-size="1.5rem" text-anchor="middle" pointer-events="none" transform="translate(-157.67722082276453, -251.73559149812462)"><tspan x="969.5933736474408" y="284.5379210730965" dy="0em" text-anchor="bottom" dominant-baseline="central">Political</tspan><tspan x="969.5933736474408" y="284.5379210730965" dy="1.1em" dominant-baseline="central">Controversies</tspan></text>
<line class="sub-cluster-label-border-connector" x1="1176.0144258443925" y1="468.68342433645444" x2="1402.0854226418346" y2="703.5518349438905" stroke-width="3" stroke="rgb(111, 215, 57)" opacity="1"></line><rect class="sub-cluster-label-border" x="1155.9669189453125" y="540.3798666000366" width="156.20196533203125" height="159.6583652496338" pointer-events="none" fill="white" stroke-width="2" stroke="rgb(111, 215, 57)" opacity="1" transform="translate(168.01749992944292, 143.20611124823654)"></rect><text class="sub-cluster-label" x="1234.0679110674184" y="560.345723695654" font-size="1.5rem" text-anchor="middle" pointer-events="none" transform="translate(168.01749992944292, 143.20611124823654)"><tspan x="1234.0679110674184" y="560.345723695654" dy="0em" text-anchor="bottom" dominant-baseline="central">Social</tspan><tspan x="1234.0679110674184" y="560.345723695654" dy="1.1em" dominant-baseline="central">Commentary</tspan><tspan x="1234.0679110674184" y="560.345723695654" dy="2.2em" dominant-baseline="central">in Music and</tspan><tspan x="1234.0679110674184" y="560.345723695654" dy="3.3000000000000003em" dominant-baseline="central">Wealth</tspan><tspan x="1234.0679110674184" y="560.345723695654" dy="4.4em" dominant-baseline="central">Inequality</tspan></text>
<line class="sub-cluster-label-border-connector" x1="1087.337260411774" y1="511.05031044068596" x2="1203.587495146693" y2="788.971253379125" stroke-width="3" stroke="rgb(99, 155, 241)" opacity="1"></line><rect class="sub-cluster-label-border" x="1058.60400390625" y="578.6591634750366" width="173.0207061767578" height="159.6583652496338" pointer-events="none" fill="white" stroke-width="2" stroke="rgb(99, 155, 241)" opacity="1" transform="translate(58.473109368063206, 190.34624788201404)"></rect><text class="sub-cluster-label" x="1145.1143698936996" y="598.6250054971109" font-size="1.5rem" text-anchor="middle" pointer-events="none" transform="translate(58.473109368063206, 190.34624788201404)"><tspan x="1145.1143698936996" y="598.6250054971109" dy="0em" text-anchor="bottom" dominant-baseline="central">Political</tspan><tspan x="1145.1143698936996" y="598.6250054971109" dy="1.1em" dominant-baseline="central">Developments</tspan><tspan x="1145.1143698936996" y="598.6250054971109" dy="2.2em" dominant-baseline="central">and</tspan><tspan x="1145.1143698936996" y="598.6250054971109" dy="3.3000000000000003em" dominant-baseline="central">Environmental</tspan><tspan x="1145.1143698936996" y="598.6250054971109" dy="4.4em" dominant-baseline="central">Threats</tspan></text>
<line class="sub-cluster-label-border-connector" x1="936.213200740996" y1="546.3355754932484" x2="894.0929328945408" y2="744.2755571501235" stroke-width="3" stroke="rgb(175, 255, 153)" opacity="1"></line><rect class="sub-cluster-label-border" x="892.86376953125" y="583.4069662094116" width="227.11151123046875" height="69.86334609985352" pointer-events="none" fill="white" stroke-width="2" stroke="rgb(175, 255, 153)" opacity="1" transform="translate(-112.32661417624001, 140.90274131896433)"></rect><text class="sub-cluster-label" x="1006.4195349714928" y="603.3728158311592" font-size="1.5rem" text-anchor="middle" pointer-events="none" transform="translate(-112.32661417624001, 140.90274131896433)"><tspan x="1006.4195349714928" y="603.3728158311592" dy="0em" text-anchor="bottom" dominant-baseline="central">Misunderstandings</tspan><tspan x="1006.4195349714928" y="603.3728158311592" dy="1.1em" dominant-baseline="central">and Tensions</tspan></text>


<g class="cluster-label-group" transform="translate(-61.50466907508394, -648.5883556487073)"><rect class="cluster-label-border" x="967.5985717773438" y="399.3179512023926" width="160.17999267578125" height="129.03681182861328" pointer-events="none" fill="white" stroke-width="3" stroke="#edc949" opacity="1"></rect><text class="cluster-label" x="1047.6885711570071" y="427.4907402252175" font-size="1.8rem" text-anchor="middle" pointer-events="none"><tspan x="1047.6885711570071" y="427.4907402252175" dy="0em" text-anchor="bottom" dominant-baseline="central">Political</tspan><tspan x="1047.6885711570071" y="427.4907402252175" dy="1.1em" dominant-baseline="central">and Social</tspan><tspan x="1047.6885711570071" y="427.4907402252175" dy="2.2em" dominant-baseline="central">Issues</tspan></text><circle class="centroid" cx="1047.6885711570071" cy="427.4907402252175" r="5" fill="red"></circle></g>